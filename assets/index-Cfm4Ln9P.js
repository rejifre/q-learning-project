var Z=Object.defineProperty;var Q=l=>{throw TypeError(l)};var tt=(l,t,e)=>t in l?Z(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var o=(l,t,e)=>tt(l,typeof t!="symbol"?t+"":t,e),_=(l,t,e)=>t.has(l)||Q("Cannot "+e);var s=(l,t,e)=>(_(l,t,"read from private field"),e?e.call(l):t.get(l)),m=(l,t,e)=>t.has(l)?Q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(l):t.set(l,e),E=(l,t,e,n)=>(_(l,t,"write to private field"),n?n.call(l,e):t.set(l,e),e),p=(l,t,e)=>(_(l,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=e(i);fetch(i.href,a)}})();class A{constructor(t,e){o(this,"x");o(this,"y");this.x=t,this.y=e}clone(){return new A(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}}const et=[{name:"CIMA",value:0},{name:"BAIXO",value:1},{name:"ESQUERDA",value:2},{name:"DIREITA",value:3}],S=[[-1,0],[1,0],[0,-1],[0,1]];class it{constructor(t){o(this,"alpha",.1);o(this,"gamma",.9);o(this,"explorationRate",.3);o(this,"episodes",1e3);o(this,"alphaInput",document.getElementById("alphaInput"));o(this,"gammaInput",document.getElementById("gammaInput"));o(this,"explorationRateInput",document.getElementById("epsilonInput"));o(this,"episodesInput",document.getElementById("episodesInput"));o(this,"qTable",[]);o(this,"mapRows");o(this,"mapCols");o(this,"currentMap",[]);o(this,"projectMap");this.mapRows=t.getMapRows(),this.mapCols=t.getMapCols(),this.currentMap=t.getMapData(),this.projectMap=t,this.qTable=[];for(let e=0;e<this.mapRows;e++){this.qTable[e]=[];for(let n=0;n<this.mapCols;n++)this.qTable[e][n]=[0,0,0,0]}}init(){this.qTable=Array(this.mapRows).fill(0).map(()=>Array(this.mapCols).fill(0).map(()=>Array(4).fill(0))),this.updateTrainingParameters()}updateTrainingParameters(){this.episodesInput&&this.episodesInput.value&&(this.episodes=parseInt(this.episodesInput.value)),this.explorationRateInput&&this.explorationRateInput.value&&(this.explorationRate=parseFloat(this.explorationRateInput.value)),this.alphaInput&&this.alphaInput.value&&(this.alpha=parseFloat(this.alphaInput.value)),this.gammaInput&&this.gammaInput.value&&(this.gamma=parseFloat(this.gammaInput.value))}getReward(t){if(t.x<0||t.x>=this.mapRows||t.y<0||t.y>=this.mapCols)return this.projectMap.REWARD_OUT_OF_BOUNDS;const e=this.currentMap[t.x][t.y];return e===-1?this.projectMap.REWARD_OUT_OF_BOUNDS:e===100?this.projectMap.REWARD_TERMINAL:e===-100?this.projectMap.REWARD_OBSTACLE:this.projectMap.REWARD_FREE}chooseAction(t){const e=Math.random();return e<this.explorationRate?Math.floor(e*S.length):this.getMaxQActionIndex(t)}getMaxQActionIndex(t){const e=this.qTable[t.x][t.y];let n=-1/0,i=0;for(let a=0;a<e.length;a++)e[a]>n&&(n=e[a],i=a);return i}updateQValue(t,e,n,i){let a=0;this.projectMap.isTerminal(i)||(a=Math.max(...this.qTable[i.x][i.y]));const r=this.qTable[t.x][t.y][e],h=r+this.alpha*(n+this.gamma*a-r);this.qTable[t.x][t.y][e]=h}getQValueAt(t,e){return t.x<0||t.x>=this.mapRows||t.y<0||t.y>=this.mapCols?0:this.qTable[t.x][t.y][e]}}var u,L,R,x,F,V,U;class nt{constructor(){m(this,x);m(this,u);m(this,L,[]);m(this,R);o(this,"REWARD_OBSTACLE",-100);o(this,"REWARD_TERMINAL",100);o(this,"REWARD_OUT_OF_BOUNDS",-200);o(this,"REWARD_FREE",-1);const t=document.getElementById("map-container");if(!t)throw new Error("Element with id 'map-container' not found.");E(this,R,t),E(this,u,p(this,x,F).call(this))}getMapRows(){return s(this,u).length}getMapCols(){return s(this,u)[0].length}getMapData(){return this.cloneMap()}cloneMap(){return s(this,u).map(t=>[...t])}getLength(){return s(this,u).length}getValueAt(t){return t.x<0||t.x>=s(this,u).length||t.y<0||t.y>=s(this,u)[0].length?this.REWARD_OUT_OF_BOUNDS:s(this,u)[t.x][t.y]===-1?this.REWARD_OUT_OF_BOUNDS:s(this,u)[t.x][t.y]}renderMap(t,e=[]){let n=0;s(this,R).innerHTML="",s(this,R).setAttribute("style",`grid-template-columns: repeat(${this.getMapCols()}, 1fr);`);for(let i=0;i<this.getLength();i++){const a=s(this,u)[i];for(let r=0;r<a.length;r++){let h=a[r];t.x===i&&t.y===r&&(h=0);const f=p(this,x,V).call(this,i,r,h,n);h!==-1&&(f.id=`S${n+1}`,n++,s(this,L).push(f.id)),e.some(B=>B.x===i&&B.y===r)&&h!==2&&s(this,u)[i][r]!==this.REWARD_TERMINAL&&f.classList.add("path"),s(this,R).appendChild(f)}}}isTerminal(t){if(t.x<0||t.x>=this.getMapRows()||t.y<0||t.y>=this.getMapCols())return!0;const e=this.getValueAt(t);return e===this.REWARD_TERMINAL||e===this.REWARD_OBSTACLE||e===-1}getMapList(){return s(this,L)}mappedMapData(){let t=1;return s(this,u).flatMap((e,n)=>e.map((i,a)=>({value:i,col:a})).filter(i=>i.value!==-1).map(i=>({id:`S${n+1}_${i.col+1}`,numberId:(t++).toString(),pos:new A(n,i.col),value:i.value})))}getTableList(t){const e=this.mappedMapData(),n=[];return e.forEach(i=>{this.getNeighborIds(i.pos).forEach(r=>{const h=e.find(f=>f.pos.equals(r.neighbor)&&f.value!==-1);h&&n.push({...i,numberId:`S${i.numberId}`,actionToText:`A${i.numberId}-${h.numberId}`,qValue:t?t[i.pos.x][i.pos.y]:void 0,direction:r.direction})})}),n}getNeighborIds(t){return S.map(([e,n],i)=>[t.x+e,t.y+n,i]).filter(([e,n])=>e>=0&&e<this.getMapRows()&&n>=0&&n<this.getMapCols()&&s(this,u)[e][n]!==-1).map(([e,n,i])=>({direction:i,neighbor:new A(e,n)}))}}u=new WeakMap,L=new WeakMap,R=new WeakMap,x=new WeakSet,F=function(){return[[1,1,1,1,-100,1,1,1,1,1,1,-100],[1,1,1,1,1,1,1,1,1,1,1,-100],[-100,1,1,1,1,1,-100,1,-100,-100,1,1],[1,-100,1,1,1,1,1,1,-100,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,100],[-1,-1,-1,-1,1,1,-100,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,-100,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]]},V=function(t,e,n,i){const a=document.createElement("div");if(n===-1)return a.classList.add(`cell-R${t}-C${e}-out-of-bounds`,"out-of-bounds"),a;a.classList.add(`cell-R${t}-C${e}`,"grid-cell");const r=document.createElement("p");return r.textContent=`S${i+1}`,r.classList.add("cell-text"),a.appendChild(r),p(this,x,U).call(this,a,n),a},U=function(t,e){switch(e){case 1:t.classList.add("free");break;case-100:t.classList.add("obstacle");break;case 0:t.classList.add("initial-state");break;case 100:t.classList.add("terminal-state");break}};var I,b,C,v,y,w,j,k;class st{constructor(t){m(this,w);m(this,I);m(this,b);m(this,C);m(this,v,0);m(this,y,0);if(E(this,I,document.getElementById("q-table-learning")),!s(this,I))throw new Error("Elemento com id 'q-table-learning' não encontrado.");s(this,I).classList.add("styled-table"),E(this,b,[...t]),E(this,y,s(this,b).length/4),E(this,v,Math.ceil(s(this,b).length/s(this,y))),E(this,C,s(this,b).map((e,n)=>new Map([[`Mapa ${n+1}`,e]])))}createTable(){s(this,I).innerHTML="";for(let t=0;t<s(this,v);t++){const e=t*s(this,y);p(this,w,j).call(this,t+1,e)}}updateTableByPosition(t,e,n){const i=`table-reward-${t.x}:${t.y}:${n??""}`,a=document.getElementById(i);a?a.textContent=`${e.toFixed(2)}`:console.warn(`Célula com ID ${i} não encontrada.`)}}I=new WeakMap,b=new WeakMap,C=new WeakMap,v=new WeakMap,y=new WeakMap,w=new WeakSet,j=function(t,e){const n=document.createElement("table");n.id=`table-${t}`,n.classList.add("item-table");const i=document.createElement("thead"),a=document.createElement("tr"),r=document.createElement("th");r.textContent="Q()",a.appendChild(r);const h=document.createElement("th");h.textContent="Recompensa",a.appendChild(h),i.appendChild(a),n.appendChild(i),p(this,w,k).call(this,n,e),s(this,I).appendChild(n)},k=function(t,e){var i,a,r,h,f,B,W;const n=document.createElement("tbody");for(let $=0;$<s(this,y);$++){const D=e+$;if(D>=s(this,C).length)break;const O=document.createElement("tr"),q=document.createElement("td"),T=`Mapa ${D+1}`,M=s(this,C)[D];q.textContent=`${(i=M.get(T))==null?void 0:i.numberId}, ${((a=M.get(T))==null?void 0:a.actionToText)??""}`,O.appendChild(q);const P=document.createElement("td");P.id=`table-reward-${(r=M.get(T))==null?void 0:r.pos.x}:${(h=M.get(T))==null?void 0:h.pos.y}:${((f=M.get(T))==null?void 0:f.direction)??""}`,P.textContent=`${((W=(B=M.get(T))==null?void 0:B.reward)==null?void 0:W.toFixed(2))??0}`,O.appendChild(P),n.appendChild(O)}t.appendChild(n)};var g,d,c,H,z,K,X,G,N,J,Y;class at{constructor(){m(this,c);m(this,g);m(this,d);o(this,"isTraining",!1);o(this,"trainingInterval",0);o(this,"episodeCounter",0);o(this,"trainButton");o(this,"resetButton");o(this,"startPoint",new A(9,4));o(this,"table");o(this,"agentPositionElement");o(this,"agentNextPositionElement");o(this,"agentRewardElement");o(this,"directionElement");E(this,d,new nt),E(this,g,new it(s(this,d))),this.trainButton=document.getElementById("trainButton"),this.resetButton=document.getElementById("resetButton"),this.agentPositionElement=document.getElementById("agent-position"),this.agentNextPositionElement=document.getElementById("agent-next-position"),this.agentRewardElement=document.getElementById("agent-reward"),this.directionElement=document.getElementById("agent-direction"),p(this,c,H).call(this),s(this,d).renderMap(this.startPoint),this.table=new st(s(this,d).getTableList()),this.table.createTable()}startTraining(){this.isTraining||(s(this,g).init(),p(this,c,z).call(this),this.trainingInterval=setInterval(()=>p(this,c,K).call(this),10))}pauseTraining(){this.trainingInterval&&clearInterval(this.trainingInterval),this.isTraining=!1,this.trainButton.textContent="Iniciar Treinamento",this.trainButton.disabled=!1,s(this,d).renderMap(this.startPoint),this.episodeCounter=0}resetTraining(){this.trainingInterval&&clearInterval(this.trainingInterval),this.isTraining=!1,this.trainButton.textContent="Iniciar Treinamento",this.trainButton.disabled=!1,this.resetButton.disabled=!0,s(this,g).init(),s(this,d).renderMap(this.startPoint),this.episodeCounter=0}}g=new WeakMap,d=new WeakMap,c=new WeakSet,H=function(){this.trainButton.addEventListener("click",()=>this.startTraining()),this.resetButton.addEventListener("click",()=>this.pauseTraining())},z=function(){s(this,d).renderMap(this.startPoint),this.episodeCounter=0,this.isTraining=!0,this.trainButton.textContent="Treinando...",this.trainButton.disabled=!0},K=function(){if(this.episodeCounter>=s(this,g).episodes){p(this,c,X).call(this);return}p(this,c,G).call(this,this.startPoint),this.episodeCounter++},X=function(){this.trainingInterval&&clearInterval(this.trainingInterval),this.isTraining=!1,this.trainButton.textContent="Treinamento Concluído!",this.trainButton.disabled=!1,this.resetButton.disabled=!1,console.log("Treinamento Q-learning concluído!");const t=p(this,c,J).call(this,this.startPoint);s(this,d).renderMap(this.startPoint,t)},G=function(t){let e=t.clone(),n=0;const i=s(this,d).getMapRows()*s(this,d).getMapCols()*2;for(;!s(this,d).isTerminal(e)&&n<i;){const a=s(this,g).chooseAction(e),r=p(this,c,N).call(this,e,a),h=s(this,g).getReward(r);if(s(this,g).updateQValue(e,a,h,r),this.table.updateTableByPosition(e,s(this,g).getQValueAt(e,a),a),p(this,c,Y).call(this,e,r,h,a),s(this,d).renderMap(this.startPoint,[e]),h===s(this,d).REWARD_OBSTACLE||h===s(this,d).REWARD_OUT_OF_BOUNDS||h===s(this,d).REWARD_TERMINAL)break;e=r.clone(),n++}},N=function(t,e){const[n,i]=S[e];return new A(t.x+n,t.y+i)},J=function(t){let e=[t.clone()],n=t.clone(),i=0;const a=100;for(;!s(this,d).isTerminal(n)&&i<a;){const r=s(this,g).getMaxQActionIndex(n),h=p(this,c,N).call(this,n,r);if(s(this,d).isTerminal(h)){s(this,d).getValueAt(h)===s(this,d).REWARD_TERMINAL&&e.push(h.clone());break}n=h.clone(),e.push(n.clone()),i++}return e},Y=function(t,e,n,i=0){var r;this.agentPositionElement.textContent=`(${t.x}, ${t.y})`,this.agentNextPositionElement.textContent=`(${e.x}, ${e.y})`,this.agentRewardElement.textContent=`${n}`,this.directionElement.textContent=`Direção: ${(r=et.find(h=>h.value===i))==null?void 0:r.name}`;const a=`Ação: ${i}, Posição Atual: (${t.x}, ${t.y}), Próxima Posição: (${e.x}, ${e.y}), Recompensa: ${n}`;console.log(a)};new at;
