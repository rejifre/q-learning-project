var j=Object.defineProperty;var D=o=>{throw TypeError(o)};var k=(o,t,e)=>t in o?j(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var h=(o,t,e)=>k(o,typeof t!="symbol"?t+"":t,e),w=(o,t,e)=>t.has(o)||D("Cannot "+e);var s=(o,t,e)=>(w(o,t,"read from private field"),e?e.call(o):t.get(o)),m=(o,t,e)=>t.has(o)?D("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(o):t.set(o,e),R=(o,t,e,a)=>(w(o,t,"write to private field"),a?a.call(o,e):t.set(o,e),e),u=(o,t,e)=>(w(o,t,"access private method"),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class L{constructor(t,e){h(this,"x");h(this,"y");this.x=t,this.y=e}clone(){return new L(this.x,this.y)}equals(t){return this.x===t.x&&this.y===t.y}}const _=[[-1,0],[1,0],[0,-1],[0,1]];class H{constructor(t){h(this,"alpha",.1);h(this,"gamma",.9);h(this,"explorationRate",.3);h(this,"episodes",1e3);h(this,"alphaInput",document.getElementById("alphaInput"));h(this,"gammaInput",document.getElementById("gammaInput"));h(this,"explorationRateInput",document.getElementById("epsilonInput"));h(this,"episodesInput",document.getElementById("episodesInput"));h(this,"qTable",[]);h(this,"mapRows");h(this,"mapCols");h(this,"currentMap",[]);h(this,"projectMap");this.mapRows=t.getMapRows(),this.mapCols=t.getMapCols(),this.currentMap=t.getMapData(),this.projectMap=t,this.qTable=[];for(let e=0;e<this.mapRows;e++){this.qTable[e]=[];for(let a=0;a<this.mapCols;a++)this.qTable[e][a]=[0,0,0,0]}}init(){this.qTable=Array(this.mapRows).fill(0).map(()=>Array(this.mapCols).fill(0).map(()=>Array(4).fill(0))),this.updateTrainingParameters()}updateTrainingParameters(){this.episodesInput&&this.episodesInput.value&&(this.episodes=parseInt(this.episodesInput.value)),this.explorationRateInput&&this.explorationRateInput.value&&(this.explorationRate=parseFloat(this.explorationRateInput.value)),this.alphaInput&&this.alphaInput.value&&(this.alpha=parseFloat(this.alphaInput.value)),this.gammaInput&&this.gammaInput.value&&(this.gamma=parseFloat(this.gammaInput.value))}getReward(t){if(t.x<0||t.x>=this.mapRows||t.y<0||t.y>=this.mapCols)return this.projectMap.REWARD_OUT_OF_BOUNDS;const e=this.currentMap[t.x][t.y];return e===-1?this.projectMap.REWARD_OUT_OF_BOUNDS:e===100?this.projectMap.REWARD_TERMINAL:e===-100||e===-1?this.projectMap.REWARD_OBSTACLE:this.projectMap.REWARD_FREE}chooseAction(t){const e=Math.random();return e<this.explorationRate?Math.floor(e*_.length):this.getMaxQActionIndex(t)}getMaxQActionIndex(t){const e=this.qTable[t.x][t.y];let a=-1/0,i=0;for(let n=0;n<e.length;n++)e[n]>a&&(a=e[n],i=n);return i}updateQValue(t,e,a,i){let n=0;this.projectMap.isTerminal(i)||(n=Math.max(...this.qTable[i.x][i.y]));const r=this.qTable[t.x][t.y][e],l=r+this.alpha*(a+this.gamma*n-r);this.qTable[t.x][t.y][e]=l,console.log(`Q[${t.x}, ${t.y}, ${e}] atualizado: ${r} → ${l}`)}}var p,y,T,E,O,$,N;class z{constructor(){m(this,E);m(this,p);m(this,y,[]);m(this,T);h(this,"REWARD_OBSTACLE",-100);h(this,"REWARD_TERMINAL",100);h(this,"REWARD_OUT_OF_BOUNDS",-200);h(this,"REWARD_FREE",-1);const t=document.getElementById("map-container");if(!t)throw new Error("Element with id 'map-container' not found.");R(this,T,t),R(this,p,u(this,E,O).call(this))}getMapRows(){return s(this,p).length}getMapCols(){return s(this,p)[0].length}getMapData(){return this.cloneMap()}cloneMap(){return s(this,p).map(t=>[...t])}getLength(){return s(this,p).length}getValueAt(t){return t.x<0||t.x>=s(this,p).length||t.y<0||t.y>=s(this,p)[0].length?this.REWARD_OUT_OF_BOUNDS:s(this,p)[t.x][t.y]===-1?this.REWARD_OUT_OF_BOUNDS:s(this,p)[t.x][t.y]}renderMap(t,e=[]){let a=0;s(this,T).innerHTML="",s(this,T).setAttribute("style",`grid-template-columns: repeat(${this.getMapCols()}, 1fr);`);for(let i=0;i<this.getLength();i++){const n=s(this,p)[i];for(let r=0;r<n.length;r++){let l=n[r];t.x===i&&t.y===r&&(l=2);const f=u(this,E,$).call(this,i,r,l,a);l!==-1&&(f.id=`S${a+1}`,a++,s(this,y).push(f.id)),e.some(C=>C.x===i&&C.y===r)&&l!==2&&s(this,p)[i][r]!==this.REWARD_TERMINAL&&f.classList.add("path"),s(this,T).appendChild(f)}}}isTerminal(t){if(t.x<0||t.x>=this.getMapRows()||t.y<0||t.y>=this.getMapCols())return!0;const e=this.getValueAt(t);return e===this.REWARD_TERMINAL||e===this.REWARD_OBSTACLE||e===-1}getMapList(){return s(this,y)}mappedMapData(){let t=1;return s(this,p).flatMap((e,a)=>e.map((i,n)=>({value:i,col:n})).filter(i=>i.value!==-1).map(i=>({id:`S${a+1}_${i.col+1}`,numberId:(t++).toString(),row:a,col:i.col,value:i.value})))}getTableList(t){const e=this.mappedMapData(),a=[];return e.forEach(i=>{this.getNeighborIds(i.row,i.col).forEach(r=>{const l=e.find(f=>f.row===r.row&&f.col===r.col);l&&a.push({...i,numberId:`S${i.numberId}`,actionTo:l.numberId,actionToText:`A${i.numberId}-${l.numberId}`,qValue:t?t[i.row][i.col]:void 0,reward:0})})}),a}getNeighborIds(t,e){return[[-1,0],[1,0],[0,-1],[0,1]].map(([i,n])=>[t+i,e+n]).filter(([i,n])=>i>=0&&i<this.getMapRows()&&n>=0&&n<this.getMapCols()&&s(this,p)[i][n]!==-1).map(([i,n])=>({row:i,col:n}))}}p=new WeakMap,y=new WeakMap,T=new WeakMap,E=new WeakSet,O=function(){return[[1,1,1,1,-100,1,1,1,1,1,1,-100],[1,1,1,1,1,1,1,1,1,1,1,-100],[-100,1,1,1,1,1,-100,1,-100,-100,1,1],[1,-100,1,1,1,1,1,1,-100,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,100],[-1,-1,-1,-1,1,1,-100,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,-100,1,-1,-1,-1,-1],[-1,-1,-1,-1,1,1,1,1,-1,-1,-1,-1]]},$=function(t,e,a,i){const n=document.createElement("div");if(a===-1)return n.classList.add(`cell-R${t}-C${e}-non-map`,"non-map"),n;n.classList.add(`cell-R${t}-C${e}`,"grid-cell");const r=document.createElement("p");return r.textContent=`S${i+1}`,r.classList.add("cell-text"),n.appendChild(r),u(this,E,N).call(this,n,a),n},N=function(t,e){switch(e){case 1:t.classList.add("free");break;case-100:t.classList.add("obstacle");break;case 2:t.classList.add("initial-state");break;case 100:t.classList.add("terminal-state");break}};var I,M,b,A,x,P,S;class K{constructor(t){m(this,x);m(this,I);m(this,M);m(this,b);m(this,A,0);if(R(this,I,document.getElementById("q-table-learning")),!s(this,I))throw new Error("Elemento com id 'q-table-learning' não encontrado.");s(this,I).classList.add("styled-table"),R(this,M,[...t]),R(this,A,Math.ceil(s(this,M).length/10)),R(this,b,s(this,M).map((e,a)=>new Map([[`Mapa ${a+1}`,e]])))}createTable(){s(this,I).innerHTML="";for(let t=0;t<s(this,A);t++){const e=t*10;u(this,x,P).call(this,t+1,e)}}}I=new WeakMap,M=new WeakMap,b=new WeakMap,A=new WeakMap,x=new WeakSet,P=function(t,e){const a=document.createElement("table");a.id=`table-${t}`,a.classList.add("item-table");const i=document.createElement("thead"),n=document.createElement("tr"),r=document.createElement("th");r.textContent="Q()",n.appendChild(r);const l=document.createElement("th");l.textContent="Recompensa",n.appendChild(l),i.appendChild(n),a.appendChild(i),u(this,x,S).call(this,a,e),s(this,I).appendChild(a)},S=function(t,e){const a=document.createElement("tbody");for(let i=0;i<10;i++){const n=e+i;if(n>=s(this,b).length)break;const r=document.createElement("tr"),l=document.createElement("td"),f=`Mapa ${n+1}`,C=s(this,b)[n];l.textContent=C.get(f)??"",r.appendChild(l);const v=document.createElement("td");v.textContent="0",r.appendChild(v),a.appendChild(r)}t.appendChild(a)};var g,c,d,W,q,Q,F,U,B,V;class G{constructor(){m(this,d);m(this,g);m(this,c);h(this,"isTraining",!1);h(this,"trainingInterval",0);h(this,"episodeCounter",0);h(this,"trainButton");h(this,"resetButton");h(this,"startPoint",new L(9,4));h(this,"table");R(this,c,new z),R(this,g,new H(s(this,c))),this.trainButton=document.getElementById("trainButton"),this.resetButton=document.getElementById("resetButton"),u(this,d,W).call(this),s(this,c).renderMap(this.startPoint),this.table=new K(s(this,c).getMapList()),this.table.createTable()}startTraining(){this.isTraining||(s(this,g).init(),u(this,d,q).call(this),this.trainingInterval=setInterval(()=>u(this,d,Q).call(this),5))}pauseTraining(){this.trainingInterval&&clearInterval(this.trainingInterval),this.isTraining=!1,this.trainButton.textContent="Iniciar Treinamento",this.trainButton.disabled=!1,s(this,c).renderMap(this.startPoint),this.episodeCounter=0}resetTraining(){this.trainingInterval&&clearInterval(this.trainingInterval),this.isTraining=!1,this.trainButton.textContent="Iniciar Treinamento",this.trainButton.disabled=!1,this.resetButton.disabled=!0,s(this,g).init(),s(this,c).renderMap(this.startPoint),this.episodeCounter=0}}g=new WeakMap,c=new WeakMap,d=new WeakSet,W=function(){this.trainButton.addEventListener("click",()=>this.startTraining()),this.resetButton.addEventListener("click",()=>this.pauseTraining())},q=function(){s(this,c).renderMap(this.startPoint),this.episodeCounter=0,this.isTraining=!0,this.trainButton.textContent="Treinando...",this.trainButton.disabled=!0},Q=function(){if(this.episodeCounter>=s(this,g).episodes){u(this,d,F).call(this);return}u(this,d,U).call(this,this.startPoint),this.episodeCounter++},F=function(){this.trainingInterval&&clearInterval(this.trainingInterval),this.isTraining=!1,this.trainButton.textContent="Treinamento Concluído!",this.trainButton.disabled=!1,this.resetButton.disabled=!1,console.log("Treinamento Q-learning concluído!");const t=u(this,d,V).call(this,this.startPoint);s(this,c).renderMap(this.startPoint,t)},U=function(t){let e=t.clone(),a=0;const i=s(this,c).getMapRows()*s(this,c).getMapCols()*2;for(;!s(this,c).isTerminal(e)&&a<i;){const n=s(this,g).chooseAction(e),r=u(this,d,B).call(this,e,n),l=s(this,g).getReward(r);if(s(this,g).updateQValue(e,n,l,r),l===s(this,c).REWARD_OBSTACLE||l===s(this,c).REWARD_OUT_OF_BOUNDS||l===s(this,c).REWARD_TERMINAL)break;e=r.clone(),a++,s(this,c).renderMap(this.startPoint,[e])}},B=function(t,e){const[a,i]=_[e];return new L(t.x+a,t.y+i)},V=function(t){let e=[t.clone()],a=t.clone(),i=0;const n=100;for(;!s(this,c).isTerminal(a)&&i<n;){const r=s(this,g).getMaxQActionIndex(a),l=u(this,d,B).call(this,a,r);if(s(this,c).isTerminal(l)){s(this,c).getValueAt(l)===s(this,c).REWARD_TERMINAL&&e.push(l.clone());break}a=l.clone(),e.push(a.clone()),i++}return e};new G;
